# ============================================================================
# BFSNet pytest Configuration
# ============================================================================
# Configuration file for pytest test runner.
#
# Usage:
#   pytest                          # Run all tests
#   pytest -v                       # Verbose output
#   pytest -m "not slow"            # Skip slow tests
#   pytest --cov=. --cov-report=html  # With coverage
#
# Updated: 2025-09-18 - Removed numpy.VisibleDeprecationWarning filter for
#                       numpy 2.x compatibility
# ============================================================================

[pytest]

# ============================================================================
# Test Discovery
# ============================================================================

# Directories to search for tests
testpaths = tests

# Python files to consider as test files
python_files = 
    test_*.py
    *_test.py

# Python classes to consider as test classes
python_classes = 
    Test*
    *Tests
    *TestCase

# Python functions to consider as test functions
python_functions = 
    test_*
    *_test

# Files and directories to ignore
norecursedirs = 
    .git
    .tox
    .eggs
    *.egg
    dist
    build
    node_modules
    __pycache__
    .pytest_cache
    .mypy_cache
    htmlcov
    .coverage
    venv
    .venv
    env
    data
    runs
    figures
    checkpoints

# ============================================================================
# Output Configuration
# ============================================================================

# Default command line options
addopts = 
    # Verbosity
    -v
    # Show extra test summary for all except passed
    -ra
    # Show local variables in tracebacks
    --tb=short
    # Strict markers (fail on unknown markers)
    --strict-markers
    # Color output
    --color=yes
    # Duration of slowest tests
    --durations=10
    # Don't capture stdout/stderr (uncomment for debugging)
    # -s

# Minimum pytest version required
minversion = 6.0

# ============================================================================
# Markers
# ============================================================================

# Custom markers (registered to avoid warnings)
markers =
    # Speed markers
    slow: marks tests as slow (deselect with '-m "not slow"')
    fast: marks tests as fast
    
    # Test type markers
    unit: marks unit tests (fast, isolated)
    integration: marks integration tests (slower, end-to-end)
    smoke: marks smoke tests (quick sanity checks)
    
    # Hardware markers
    gpu: marks tests requiring GPU (skip with '-m "not gpu"')
    cuda: marks tests requiring CUDA
    cpu: marks tests that should run on CPU only
    multi_gpu: marks tests requiring multiple GPUs
    
    # Feature markers
    model: marks tests for BFSNet model
    losses: marks tests for loss functions
    gating: marks tests for gating functions
    sparse: marks tests for sparse utilities
    config: marks tests for configuration loading
    training: marks tests for training pipeline
    inference: marks tests for inference pipeline
    visualization: marks tests for visualization
    
    # Special markers
    parametrize: built-in marker for parametrized tests
    skip: built-in marker to skip tests
    skipif: built-in marker to conditionally skip tests
    xfail: built-in marker for expected failures
    flaky: marks tests that may fail intermittently

# ============================================================================
# Logging Configuration
# ============================================================================

# Log level for captured logs
log_cli = false
log_cli_level = INFO
log_cli_format = %(asctime)s [%(levelname)8s] %(name)s: %(message)s
log_cli_date_format = %Y-%m-%d %H:%M:%S

# Log file (uncomment to enable)
# log_file = tests/pytest.log
# log_file_level = DEBUG
# log_file_format = %(asctime)s [%(levelname)8s] %(filename)s:%(lineno)d - %(message)s
# log_file_date_format = %Y-%m-%d %H:%M:%S

# ============================================================================
# Warning Configuration
# ============================================================================

# Filter warnings
filterwarnings =
    # Treat all warnings as errors (strict mode)
    # error
    
    # Ignore specific warnings
    ignore::DeprecationWarning
    ignore::PendingDeprecationWarning
    ignore::FutureWarning
    
    # Ignore PyTorch specific warnings
    ignore::UserWarning:torch.*
    ignore:.*torch.cuda.amp.*:FutureWarning
    
    # Note: numpy.VisibleDeprecationWarning was removed in numpy 2.0
    # The generic DeprecationWarning filter above covers numpy deprecations

# ============================================================================
# Coverage Configuration (pytest-cov)
# ============================================================================

# Note: These settings are also read by coverage.py
# Full coverage config can also be in .coveragerc or pyproject.toml

# Source directories to measure
# (specified via --cov=. on command line)

# ============================================================================
# Timeout Configuration (pytest-timeout)
# ============================================================================

# Default timeout for each test (seconds)
# Uncomment and install pytest-timeout to enable
# timeout = 300

# Method for implementing timeout (signal, thread)
# timeout_method = thread

# ============================================================================
# Parallel Execution (pytest-xdist)
# ============================================================================

# Number of parallel workers
# Use 'auto' for number of CPUs, or specify number
# Run with: pytest -n auto
# looponfailroots = tests

# ============================================================================
# Fixture Configuration
# ============================================================================

# Scope of autouse fixtures
# usefixtures = set_random_seeds

# ============================================================================
# Cache Configuration
# ============================================================================

# Cache directory (relative to rootdir)
cache_dir = .pytest_cache

# ============================================================================
# Console Output
# ============================================================================

# Show capture output for passed tests (useful for debugging)
# options: no, stdout, stderr, log, all
# capture = no

# Show assertion introspection details
# (helps debug complex assertions)
# verbose = 2

# ============================================================================
# Doctest Configuration
# ============================================================================

# Enable doctest discovery
# addopts = --doctest-modules

# Doctest options
doctest_optionflags = 
    NORMALIZE_WHITESPACE
    IGNORE_EXCEPTION_DETAIL
    ELLIPSIS

# ============================================================================
# Test Ordering (pytest-ordering)
# ============================================================================

# Uncomment to randomize test order (helps find order-dependent bugs)
# Requires pytest-random-order plugin
# addopts = --random-order

# ============================================================================
# Environment Variables
# ============================================================================

# Set environment variables for tests
env =
    PYTHONHASHSEED=42
    BFSNET_TEST_MODE=1
    CUDA_VISIBLE_DEVICES=

# ============================================================================
# Required Plugins
# ============================================================================

# Plugins that must be installed
# required_plugins = 
#     pytest-cov>=2.12.0
#     pytest-timeout>=1.4.0